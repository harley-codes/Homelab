version: "3.8"

services:
  service-code-vscode:
    image: lscr.io/linuxserver/code-server:latest
    container_name: service-code-vscode
    restart: unless-stopped
    user: "${VAR_PUID}:${VAR_PGID}"
    security_opt:
      - no-new-privileges:true
    networks:
      - proxy
    ports:
      - "8443:8443"
    environment:
      - PUID=${VAR_PUID}
      - PGID=${VAR_PGID}
      - TZ=${VAR_TZ}
      - HASHED_PASSWORD=${VAR_PASSWORD_HASH}
      - PWA_APPNAME=${VAR_APPNAME}
      - PROXY_DOMAIN=${VAR_PROXY_HOST}
      - DEFAULT_WORKSPACE=/home/coder/dev
    volumes:
      - service-code-vscode-config:/config
      - service-code-vscode-dev:/home/coder/dev
    labels:
      traefik.enable: "true"
      traefik.http.routers.service-code-vscode.rule: "Host(`${VAR_PROXY_HOST}`)"
      traefik.http.routers.service-code-vscode.entrypoints: "websecure"
      traefik.http.routers.service-code-vscode.tls: "true"
      traefik.http.routers.service-code-vscode.tls.certresolver: "cloudflare"
      traefik.http.services.service-code-vscode.loadbalancer.server.port: "8443"

networks:
  proxy:
    external: true

volumes:
  service-code-vscode-config:
  service-code-vscode-dev:
